@model T_Stock.Models.SupplierViewModel

<h2>Edit Supplier: @Model.SupplierId</h2>

<form asp-action="UpdateSupplier" asp-controller="Supplier" method="post" id="editSupplierForm">
    <div class="supplierDetail">

        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <input type="hidden" asp-for="SupplierId" />

        <label>Company Name</label>
        <span asp-validation-for="Company" class="text-danger"></span>
        <input asp-for="Company"/>

        <div class="supplierContact">
            <div>
        <label>Contact Person</label>
        <span asp-validation-for="ContactPerson" class="text-danger"></span>
        <input asp-for="ContactPerson"/>
            </div>

            <div>
        <label>Phone</label>
        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
        <input asp-for="PhoneNumber"/>
            </div>
            
            <div>
        <label>Email Address</label>
        <span asp-validation-for="Email" class="text-danger"></span>
        <input asp-for="Email"/>
            </div>
             
        </div>

        <label>Address</label>
        <span asp-validation-for="Address" class="text-danger"></span>
        <input asp-for="Address"/>

        <h3>Product(s) Supplied</h3>

        <div id="supplierProductList">
            @if (Model.ProductItems != null)
            {
                // Loop with 'i' to generate correct indices [0], [1]
                for (int i = 0; i < Model.ProductItems.Count; i++)
                {
                    <div class="productRow">
                        <div>
                            <h5>Product</h5>
                            <select name="ProductItems[@i].ProductID" class="productSelect">
                                <option value="">Select Product</option>
                                @foreach (var p in ViewBag.Products)
                                {
                                    // Pre-select the correct option
                                    var isSelected = p.ProductId == Model.ProductItems[i].ProductID ? "selected" : "";
                                    if (p.ProductId == Model.ProductItems[i].ProductID)
                                    {
                                        <option value="@p.ProductId" selected>@p.ProductId - @p.ProductName</option>
                                    }
                                    else
                                    {
                                        <option value="@p.ProductId">@p.ProductId - @p.ProductName</option>
                                    }
                                }
                            </select>
                        </div>
                        <div>
                            <label>Unit Price (RM)</label>
                            <input type="number"
                                   name="ProductItems[@i].SupplierPrice"
                                   value="@Model.ProductItems[i].SupplierPrice"
                                   class="productPrice" />
                        </div>
                        <button type="button" class="removeProductBtn"> <i class="ri-close-circle-line"></i> </button>
                    </div>
                }
            }
        </div>

        <button type="button" id="addProductBtn" class="addProductBtn">Add Product</button>
    </div>

    <div class="decisionBtn">
        <button type="button" class="cancelBtn">Cancel</button>
        <button type="submit" class="saveBtn">Save Changes</button>
    </div>
</form>