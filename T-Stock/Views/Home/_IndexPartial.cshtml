@{
    ViewData["Title"] = "Home";
    string email = Context.Request.Cookies["User"] ?? "Guest";
    string role = Context.Request.Cookies["Role"] ?? "No Role";
    var displayName = email.Contains("@") ? email.Split('@')[0] : email;
}

<title>@ViewData["Title"]</title>
@model List<T_Stock.Models.Product>


<div class="main-content">
    <div class="container">
        <h3>Welcome @displayName !</h3>
    </div>

    <div class="search-container">
        <input type="text" id="searchBox" placeholder="Search..." />
        <i class="ri-search-line"></i>
        <div id="search-results"></div>
    </div>

    <div class="notitoggle">
        <div class="notification">
            <a class="ajax-nav" asp-controller="Notification" asp-action="Index">
                <i class="ri-notification-4-fill"></i>
                <span id="notificationBadge" class="noti-badge">0</span>
            </a>
        </div>
        <div class="theme-toggle" id="themeToggle">
            <i class="ri-sun-fill"></i>
            <div class="toggle-ball"></div>
            <i class="ri-moon-fill"></i>
        </div>
    </div>
</div>

<div class="dashboard">
    <h3>Overview</h3>
    <div class="info">
        <a class="ajax-nav" href="/Inventory/Index" data-ajax="page">
            <div class="product">
                <div class="i-dashboard">
                    <i class="ri-box-3-fill"></i>
                </div>
                <div class="product-text">
                    <h2>@ViewBag.TotalStockQuantity</h2>
                    <p>Stock Quantity</p>
                </div>
            </div>
        </a>


        <a class="ajax-nav" href="/Inventory/Index" data-ajax="page">
            <div class="order">
                <div class="i-dashboard">
                    <i class="ri-file-list-fill"></i>
                </div>
                <div class="order-text">
                    <h2>@ViewBag.TotalOrders</h2>
                    <p>Orders</p>
                </div>
            </div>
        </a>

        <a class="ajax-nav" href="/Stock/Index" data-ajax="page">
            <div class="stock">
                <div class="i-dashboard">
                    <i class="ri-increase-decrease-fill"></i>
                </div>
                <div class="stock-text">
                    <h2>@ViewBag.TotalTransactions</h2>
                    <p>Transactions</p>
                </div>
            </div>
        </a>

        <a class="ajax-nav" href="/Stock/Index" data-ajax="page">
            <div class="out-of-stock">
                <div class="i-dashboard-out">
                    <i class="ri-dropbox-fill"></i>
                </div>
                <div class="outstock-text">
                    <h2>@ViewBag.OutOfStockCount</h2>
                    <p>Low Stock</p>
                </div>
            </div>
        </a>
    </div>
</div>

<div class="down_container">
    <div class="sales">
        <h3>Top 5 Sales</h3>
        <p>Pen</p>
        <p>Pencil</p>
        <p>Book</p>
        <p>Apple</p>
        <p>Grape</p>
    </div>

    <div class="budget">
        <h3>Monthly Budget</h3>
        <h4>RM 1000</h4>
    </div>

    <div class="purchase-order">
        <h3>Purchase Order</h3>
        <h4>@ViewBag.PendingPOCount Pending</h4>
    </div>
</div>

<script>
    (function() {
        // Function to update the notification badge
        function updateNotificationCount() {
            fetch('/Notification/GetAlertCount')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('notificationBadge');
                    if (data.count > 0) {
                        badge.textContent = data.count > 99 ? '99+' : data.count; // Cap at 99+
                        badge.style.display = 'flex'; // Show badge
                    } else {
                        badge.style.display = 'none'; // Hide badge if 0
                    }
                })
                .catch(error => console.error('Error fetching notification count:', error));
        }

        // Run immediately on load
        updateNotificationCount();

        // Optional: Re-run every 30 seconds to keep it updated without refresh
        setInterval(updateNotificationCount, 30000);
    })();
</script>