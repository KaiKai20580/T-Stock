@model T_Stock.Models.StockTransactionListVM

@{
    // Retrieve the specific Transaction ID
    var currentTxId = ViewData["TransactionID"] as string;

    // 1. Filter items for this transaction
    // 2. Group by ProductID to merge duplicates for display
    var detailItems = Model?.TransactionItems?
        .Where(ti => ti.TransactionID == currentTxId)
        .GroupBy(ti => ti.ProductID)
        .Select(g => new
        {
            ProductID = g.Key,
            // Sum the quantity of merged rows
            TotalQty = g.Sum(x => x.QtyChange),
            // Optional: Combine remarks if they are different
            CombinedRemarks = string.Join("; ", g.Select(x => x.Remarks).Where(r => !string.IsNullOrEmpty(r)).Distinct())
        })
        .ToList();
}

<div class="simple-list-wrapper">
    <h5 class="list-title">Transaction Items</h5>

    @if (detailItems != null && detailItems.Any())
    {
        <ul class="stock-item-list">
            @foreach (var item in detailItems)
            {
                // Lookup Product Name
                var product = Model.Products?.FirstOrDefault(p => p.ProductId == item.ProductID);
                string productName = product?.ProductName ?? "Unknown Product";

                <li>
                    <span class="product-name">@productName</span>:
                    <span class="qty-text">@item.TotalQty units</span>

                    @if (!string.IsNullOrEmpty(item.CombinedRemarks))
                    {
                        <span class="remarks-text">(@item.CombinedRemarks)</span>
                    }
                </li>
            }
        </ul>
    }
    else
    {
        <div class="empty-state">
            No items found.
        </div>
    }
</div>

<style>
    /* --- Wrapper --- */
    .simple-list-wrapper {
        background-color: #fff;
        padding: 15px;
        border: 1px solid #eaeaea;
        border-radius: 6px;
        margin: 10px 0;
    }

    .list-title {
        margin: 0 0 10px 0;
        font-size: 0.9rem;
        font-weight: 700;
        color: #5f6368;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
    }

    /* --- List Styling --- */
    .stock-item-list {
        list-style-type: disc; /* Simple bullets */
        padding-left: 20px; /* Indent for bullets */
        margin: 0;
    }

        .stock-item-list li {
            margin-bottom: 6px;
            color: #333;
            font-size: 0.95rem;
            line-height: 1.5;
        }

            .stock-item-list li:last-child {
                margin-bottom: 0;
            }

    /* --- Content Styling --- */
    .product-name {
        font-weight: 600;
        color: #2c3e50;
    }

    .qty-text {
        font-weight: 500;
        color: #1976d2; /* Blue highlight for numbers */
    }

    .remarks-text {
        color: #888;
        font-style: italic;
        font-size: 0.85em;
        margin-left: 5px;
    }

    .empty-state {
        color: #999;
        font-style: italic;
        padding: 5px 0;
    }
</style>