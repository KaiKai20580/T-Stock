@model IEnumerable<T_Stock.Models.Product>
@{
    ViewData["Title"] = "Notifications";

    // 1. Logic: Filter for Out of Stock (0) and Low Stock (<= ReorderLevel)
    var outOfStockItems = Model.Where(p => p.Quantity == 0).ToList();
    var lowStockItems = Model.Where(p => p.Quantity > 0 && p.Quantity <= p.ReorderLevel).ToList();

    var totalAlerts = outOfStockItems.Count + lowStockItems.Count;
}

<div class="NOTI-CONTAINER">

    <div class="noti-header">
        <div class="header-text">
            <h2>Notifications</h2>
            @if (totalAlerts > 0)
            {
                <span class="badge">@totalAlerts New</span>
            }
        </div>
        <div class="header-actions">
            <a class="ajax-nav btn-back" asp-action="Index" asp-controller="Home">
                <i class="ri-arrow-left-line"></i> Back
            </a>
        </div>
    </div>

    <div class="noti-list">

        @if (totalAlerts == 0)
        {
            <div class="empty-state">
                <i class="ri-check-double-line" style="color: #2ecc71;"></i>
                <p>All stock levels are healthy.</p>
            </div>
        }

        @* --- CHANGED SECTION: Out of Stock --- *@
        @foreach (var item in outOfStockItems)
        {
            <div class="noti-item critical unread">
                <div class="noti-icon">
                    <i class="ri-alarm-warning-fill"></i>
                </div>
                <div class="noti-content">
                    <div class="noti-title">
                        Out of Stock: @item.ProductName
                        <span class="time">Immediate Action</span>
                    </div>
                    <p class="noti-msg">
                        Current Quantity is <strong>0</strong>.
                        Reorder Level is @item.ReorderLevel.
                        <br />
                        <small style="color:#888;">ID: @item.ProductId</small>
                    </p>
                </div>
                <div class="noti-action">
                    <a asp-controller="Stock"
                       asp-action="CreateTransaction"
                       asp-route-productId="@item.ProductId"
                       class="btn-sm btn-danger">
                        Restock
                    </a>
                </div>
            </div>
        }

        @foreach (var item in lowStockItems)
        {
            <div class="noti-item warning unread">
                <div class="noti-icon">
                    <i class="ri-alert-line"></i>
                </div>
                <div class="noti-content">
                    <div class="noti-title">
                        Low Stock: @item.ProductName
                        <span class="time">Warning</span>
                    </div>
                    <p class="noti-msg">
                        Quantity <strong>@item.Quantity</strong> is below Reorder Level (@item.ReorderLevel).
                    </p>
                </div>
                <div class="noti-action">
                    @* UPDATED LINK: Redirects to Stock/Create *@
                    <a asp-controller="Stock"
                       asp-action="CreateTransaction"
                       asp-route-productId="@item.ProductId"
                       class="btn-sm btn-outline">
                        View
                    </a>
                </div>
            </div>
        }

    </div>
</div>

<style>
    /* CSS remains exactly the same as your request */
    .NOTI-CONTAINER {
        max-width: 800px;
        margin: 30px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        padding: 30px;
        font-family: 'Segoe UI', sans-serif;
    }

    .noti-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
    }

    .header-text {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .noti-header h2 {
        margin: 0;
        font-size: 24px;
        color: #333;
    }

    .badge {
        background: #ff4757;
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        fontWeight: 600;
    }

    .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .btn-back {
        text-decoration: none;
        color: #666;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
        transition: color 0.2s;
    }

        .btn-back:hover {
            color: #000;
        }

    .noti-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .noti-item {
        display: flex;
        align-items: flex-start;
        padding: 15px;
        border-radius: 8px;
        background: #fdfdfd;
        border: 1px solid #eee;
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .noti-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .noti-item.unread {
            background: #fff;
            border-left: 4px solid #007bff;
        }

    .noti-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-right: 15px;
        flex-shrink: 0;
    }

    .noti-item.critical .noti-icon {
        background: #ffe0e0;
        color: #ff4757;
    }

    .noti-item.critical.unread {
        border-left-color: #ff4757;
    }

    .noti-item.warning .noti-icon {
        background: #fff4e0;
        color: #ffa502;
    }

    .noti-item.warning.unread {
        border-left-color: #ffa502;
    }

    .noti-content {
        flex-grow: 1;
    }

    .noti-title {
        font-weight: 600;
        color: #2f3542;
        margin-bottom: 4px;
        display: flex;
        justify-content: space-between;
        padding-right: 10px;
    }

        .noti-title .time {
            font-size: 12px;
            color: #a4b0be;
            font-weight: normal;
        }

    .noti-msg {
        margin: 0;
        font-size: 14px;
        color: #57606f;
        line-height: 1.4;
    }

    .noti-action {
        align-self: center;
        flex-shrink: 0;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 4px;
        cursor: pointer;
        border: none;
        font-weight: 500;
        transition: opacity 0.2s;
        text-decoration: none;
        display: inline-block;
    }

    .btn-danger {
        background-color: #ff4757;
        color: white;
    }

    .btn-outline {
        background: transparent;
        border: 1px solid #ccc;
        color: #333;
    }

    .btn-sm:hover {
        opacity: 0.8;
    }

    .empty-state {
        text-align: center;
        padding: 50px 0;
        color: #999;
    }

        .empty-state i {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }
</style>